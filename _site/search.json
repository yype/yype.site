[
  
    {

      "title"    : "PlaidCTF2020 The Watness 2 Write-up",
      "url"      : "/2020/04/20/hypercard-over-windows",
      "category" : "",
      "tags"     : "Write-up, Reverse Engineering, Hypercard, PlaidCTF, PlaidCTF2020",
      "date"     : "2020-04-20 00:00:00 +0800",
      "description" : "",
      "content"  : "IntroRecently in PlaidCTF2020 there was a challenge called The Watness 2, which is a game that requires HyperCard to run. Since I did not have a Macbook computer, Id been struggling figuring out ways to run this game over my Windows 10 laptop. Here is how I finally managed to do that.Steps      Follow this great video tutorial        Download StuffitExpander, add it to the volumes list, install it inside the VM:            Download HyperCard 2.4, install it inside the VM as described above        Extract the .rc1 file from the .sit file and open it with a simple double-click:      Challenge SolutionExtract the stacks script code:on openCard  Send colorMe to this card  pass openCardend openCardon closeCard  global prev_card  get the id of this cd  put it into prev_card  lock screen  pass closeCardend closeCardon colorMe  AddColor colorCard,stamp,0end colorMeon openStack  AddColor install  setupMenu  go to card &quot;tun-1-n&quot;  pass openStackend openStackon closeStack  AddColor remove  pass closeStackend closeStackon genPuzzle  send &quot;doMenu New Button&quot; to Hypercardend genPuzzleon initCard  answer prev_cardend initCardon menuReset  setupMenu  pass menuResetend menuReseton setupMenu  if there is not a menu &quot;Watness&quot; then    create menu &quot;Watness&quot;    put &quot;Generate Puzzle&quot;&amp;amp;return&amp;amp;&quot;Init Card&quot;&amp;amp;return&amp;amp;&quot;Set up Nav&quot;&amp;amp;return&amp;amp;&quot;Create Puzzle&quot; into menu &quot;Watness&quot; with menuMsg genPuzzle,initCard,setupNav,constructPuzzle  end ifend setupMenuon setupNav  ask &quot;What is the name of this card&quot;  set name of this cd to it    ask &quot;Where should the left go?&quot;  put it into left_loc  send &quot;doMenu New Button&quot; to Hypercard  set height of the last button to 342  set width of the last button to 100  set topleft of the last button to &quot;0,0&quot;  set style of the last button to &quot;transparent&quot;  set name of the last button to &quot;&quot;  put &quot;on mouseUp&quot;&amp;amp;return&amp;amp;&quot;go to card &quot;&amp;amp;quote&amp;amp;&quot;&quot;&amp;amp;left_loc&amp;amp;quote&amp;amp;return&amp;amp;&quot;end mouseUp&quot; into left_script  set script of last button to left_script    ask &quot;Where should the right go?&quot;  put it into right_loc  send &quot;doMenu New Button&quot; to Hypercard  set height of the last button to 342  set width of the last button to 100  set topleft of the last button to &quot;412,0&quot;  set style of the last button to &quot;transparent&quot;  set name of the last button to &quot;&quot;  put &quot;on mouseUp&quot;&amp;amp;return&amp;amp;&quot;go to card &quot;&amp;amp;quote&amp;amp;&quot;&quot;&amp;amp;right_loc&amp;amp;quote&amp;amp;return&amp;amp;&quot;end mouseUp&quot; into right_script  set script of last button to right_script    ask &quot;Where should fwd go?&quot;  put it into fwd_loc  send &quot;doMenu New Button&quot; to Hypercard  set height of the last button to 342  set width of the last button to 311  set the top of the last button to 0  set the left of the last button to 100  set style of the last button to &quot;transparent&quot;  set name of the last button to &quot;&quot;  put &quot;on mouseUp&quot;&amp;amp;return&amp;amp;&quot;go to card &quot;&amp;amp;quote&amp;amp;&quot;&quot;&amp;amp;fwd_loc&amp;amp;quote&amp;amp;return&amp;amp;&quot;end mouseUp&quot; into fwd_script  set script of last button to fwd_script    get the script of this card  put it into cd_script  put cd_script&amp;amp;return into cd_script  put cd_script&amp;amp;&quot;on arrowKey key&quot;&amp;amp;return into cd_script  put cd_script&amp;amp;&quot; if key = &quot;&amp;amp;quote&amp;amp;&quot;left&quot;&amp;amp;quote&amp;amp;&quot;then&quot;&amp;amp;return into cd_script  put cd_script&amp;amp;&quot;  go to cd &quot;&amp;amp;quote&amp;amp;left_loc&amp;amp;quote&amp;amp;return into cd_script  put cd_script&amp;amp;&quot; end if&quot;&amp;amp;return into cd_script  put cd_script&amp;amp;&quot; if key = &quot;&amp;amp;quote&amp;amp;&quot;right&quot;&amp;amp;quote&amp;amp;&quot;then&quot;&amp;amp;return into cd_script  put cd_script&amp;amp;&quot;  go to cd &quot;&amp;amp;quote&amp;amp;right_loc&amp;amp;quote&amp;amp;return into cd_script  put cd_script&amp;amp;&quot; end if&quot;&amp;amp;return into cd_script  put cd_script&amp;amp;&quot; if key = &quot;&amp;amp;quote&amp;amp;&quot;up&quot;&amp;amp;quote&amp;amp;&quot;then&quot;&amp;amp;return into cd_script  put cd_script&amp;amp;&quot;  go to cd &quot;&amp;amp;quote&amp;amp;fwd_loc&amp;amp;quote&amp;amp;return into cd_script  put cd_script&amp;amp;&quot; end if&quot;&amp;amp;return into cd_script  put cd_script&amp;amp;&quot;end arrowKey&quot;&amp;amp;return into cd_script      set the script of this cd to cd_scriptend setupNavon makeNode  global node  send &quot;doMenu New Button&quot; to Hypercard  put the id of the last button into nodeend makeNodeon constructPuzzle  global node,constraints    ask &quot;What are the constraints&quot;  put it into constraints    get the script of this cd  put it into cd_script  put cd_script&amp;amp;return into cd_script  put cd_script&amp;amp;&quot;on openCard&quot;&amp;amp;return into cd_script  put cd_script&amp;amp;&quot;  global constraints,path,cursor_x,cursor_y,&quot; into cd_script    put 0 into i  repeat for 8        put 0 into j    repeat for 8      put cd_script&amp;amp;&quot;active_&quot;&amp;amp;i&amp;amp;&quot;_&quot;&amp;amp;j&amp;amp;&quot;,&quot; into cd_script            put j+1 into j    end repeat        put i+1 into i  end repeat    put cd_script&amp;amp;&quot;dummy&quot;&amp;amp;return into cd_script  put cd_script&amp;amp;&quot;  colorme&quot;&amp;amp;return into cd_script  put cd_script&amp;amp;&quot;  put -1 into cursor_x&quot;&amp;amp;return into cd_script  put cd_script&amp;amp;&quot;  put 0 into cursor_y&quot;&amp;amp;return into cd_script  put cd_script&amp;amp;&quot;  put &quot;&amp;amp;quote&amp;amp;quote&amp;amp;&quot; into path&quot;&amp;amp;return into cd_script  put cd_script&amp;amp;&quot;  put &quot;&amp;amp;quote&amp;amp;constraints&amp;amp;quote&amp;amp;&quot; into constraints&quot;&amp;amp;return into cd_script    put 1 into c_i  put 0 into i  repeat for 7        put 0 into j    repeat for 7      get char (j*7+i+1) of constraints      put it into letter            if letter &amp;lt;&amp;gt; &quot; &quot; then        makeNode                set the width of button id node to 10        set the height of button id node to 10                set the top of button id node to (76 + j * 30)        set the left of button id node to (161 + i * 30)                set the style of button id node to &quot;opaque&quot;        set showName of button id node to false                if letter = &quot;r&quot; then          put &quot;65535,0,0&quot; into node_color        end if        if letter = &quot;g&quot; then          put &quot;0,65535,0&quot; into node_color        end if        if letter = &quot;b&quot; then          put &quot;0,0,65535&quot; into node_color        end if                if letter &amp;lt;&amp;gt; &quot; &quot; then          addColor colorButton, cd, node, node_color                    put cd_script&amp;amp;&quot;  addColor colorButton, cd, &quot;&amp;amp;node&amp;amp;&quot;, &quot;&amp;amp;quote&amp;amp;node_color&amp;amp;quote&amp;amp;return into cd_script        end if      end if                        put j+1 into j    end repeat        put i+1 into i  end repeat        put 0 into i  repeat for 8        put 0 into j    repeat for 8      put cd_script&amp;amp;&quot;  put &quot;&amp;amp;quote&amp;amp;quote&amp;amp;&quot; into active_&quot;&amp;amp;i&amp;amp;&quot;_&quot;&amp;amp;j&amp;amp;return into cd_script            put j+1 into j    end repeat        put i+1 into i  end repeat    makeNode    set the width of button id node to 10  set the height of button id node to 15  set the left of button id node to 356  set the top of button id node to 276  set the name of button id node to &quot;path_extension&quot;  set showName of button id node to false  set the style of button id node to opaque  addcolor colorButton, cd, node, &quot;37632,30208,12288&quot;    put &quot;&quot; into node_script  put node_script&amp;amp;&quot;on checkYoSelf&quot;&amp;amp;return into node_script  put node_script&amp;amp;&quot;  addcolor colorButton, cd, &quot;&amp;amp;node&amp;amp;&quot;, &quot;&amp;amp;quote&amp;amp;&quot;65535,65535,30000&quot;&amp;amp;quote&amp;amp;return into node_script  put node_script&amp;amp;&quot;end checkYoSelf&quot;&amp;amp;return into node_script    set the script of button id node to node_script    put cd_script&amp;amp;&quot;  addcolor colorButton, cd, &quot;&amp;amp;node&amp;amp;&quot;, &quot;&amp;amp;quote&amp;amp;&quot;37632,30208,12288&quot;&amp;amp;quote&amp;amp;return into cd_script      makeNode    set the width of button id node to 10  set the height of button id node to 10  set the left of button id node to 356  set the top of button id node to 286  set the name of button id node to &quot;finale&quot;  set showName of button id node to false  set the style of button id node to oval  addcolor colorButton, cd, node, &quot;37632,30208,12288&quot;    put &quot;&quot; into node_script  put node_script&amp;amp;&quot;on mouseUp&quot;&amp;amp;return into node_script  put node_script&amp;amp;&quot;  global cursor_x, cursor_y&quot;&amp;amp;return into node_script  put node_script&amp;amp;&quot;  if (cursor_x = 7) and (cursor_y = 7) then&quot;&amp;amp;return into node_script  put node_script&amp;amp;&quot;    addcolor colorButton, cd, &quot;&amp;amp;node&amp;amp;&quot;, &quot;&amp;amp;quote&amp;amp;&quot;65535,65535,30000&quot;&amp;amp;quote&amp;amp;return into node_script  put node_script&amp;amp;&quot;    send &quot;&amp;amp;quote&amp;amp;&quot;checkYoSelf&quot;&amp;amp;quote&amp;amp;&quot; to button path_extension&quot;&amp;amp;return into node_script  put node_script&amp;amp;&quot;    send &quot;&amp;amp;quote&amp;amp;&quot;checkSolution&quot;&amp;amp;quote&amp;amp;&quot; to this cd&quot;&amp;amp;return into node_script  put node_script&amp;amp;&quot;  end if&quot;&amp;amp;return into node_script  put node_script&amp;amp;&quot;end mouseUp&quot;&amp;amp;return into node_script    set the script of button id node to node_script    put cd_script&amp;amp;&quot;  addcolor colorButton, cd, &quot;&amp;amp;node&amp;amp;&quot;, &quot;&amp;amp;quote&amp;amp;&quot;37632,30208,12288&quot;&amp;amp;quote&amp;amp;return into cd_script    put 0 into i  repeat for 7        put 0 into j    repeat for 8      makeNode            set the width of button id node to 30      set the height of button id node to 10            set the top of button id node to (61 + 30 * j)      set the left of button id node to (151 + 30 * i)            set the style of button id node to opaque      set the name of button id node to &quot;h_path_&quot;&amp;amp;i&amp;amp;&quot;_&quot;&amp;amp;j            set showName of button id node to false            addcolor colorButton, cd, node, &quot;37632,30208,12288&quot;            put cd_script&amp;amp;&quot;  addcolor colorButton, cd, &quot;&amp;amp;node&amp;amp;&quot;, &quot;&amp;amp;quote&amp;amp;&quot;37632,30208,12288&quot;&amp;amp;quote&amp;amp;return into cd_script            get the script of button id node      put it into node_script            put &quot;active_&quot;&amp;amp;i&amp;amp;&quot;_&quot;&amp;amp;j into f_node      put &quot;active_&quot;&amp;amp;(i+1)&amp;amp;&quot;_&quot;&amp;amp;j into s_node            put node_script&amp;amp;return into node_script      put node_script&amp;amp;&quot;on checkYoSelf&quot;&amp;amp;return into node_script      put node_script&amp;amp;&quot;  global &quot;&amp;amp;f_node&amp;amp;&quot;,&quot;&amp;amp;s_node&amp;amp;return into node_script      put node_script&amp;amp;&quot;  if (&quot;&amp;amp;f_node&amp;amp;&quot; = true) and (&quot;&amp;amp;s_node&amp;amp;&quot; = true) then&quot;&amp;amp;return into node_script      put node_script&amp;amp;&quot;    addcolor colorButton, cd, &quot;&amp;amp;node&amp;amp;&quot;, &quot;&amp;amp;quote&amp;amp;&quot;65535,65535,30000&quot;&amp;amp;quote&amp;amp;return into node_script      put node_script&amp;amp;&quot;  end if&quot;&amp;amp;return into node_script      put node_script&amp;amp;&quot;end checkYoSelf&quot;&amp;amp;return into node_script            set the script of button id node to node_script            put j+1 into j    end repeat        put i+1 into i  end repeat    put 0 into i  repeat for 8        put 0 into j    repeat for 7      makeNode            set the width of button id node to 10      set the height of button id node to 30            set the top of button id node to (66 + 30 * j)      set the left of button id node to (146 + 30 * i)            set the style of button id node to opaque      set the name of button id node to &quot;v_path_&quot;&amp;amp;i&amp;amp;&quot;_&quot;&amp;amp;j            set showName of button id node to false            addcolor colorButton, cd, node, &quot;37632,30208,12288&quot;            put cd_script&amp;amp;&quot;  addcolor colorButton, cd, &quot;&amp;amp;node&amp;amp;&quot;, &quot;&amp;amp;quote&amp;amp;&quot;37632,30208,12288&quot;&amp;amp;quote&amp;amp;return into cd_script            get the script of button id node      put it into node_script            put &quot;active_&quot;&amp;amp;i&amp;amp;&quot;_&quot;&amp;amp;j into f_node      put &quot;active_&quot;&amp;amp;i&amp;amp;&quot;_&quot;&amp;amp;(j+1) into s_node            put node_script&amp;amp;return into node_script      put node_script&amp;amp;&quot;on checkYoSelf&quot;&amp;amp;return into node_script      put node_script&amp;amp;&quot;  global &quot;&amp;amp;f_node&amp;amp;&quot;,&quot;&amp;amp;s_node&amp;amp;return into node_script      put node_script&amp;amp;&quot;  if (&quot;&amp;amp;f_node&amp;amp;&quot; = true) and (&quot;&amp;amp;s_node&amp;amp;&quot; = true) then&quot;&amp;amp;return into node_script      put node_script&amp;amp;&quot;    addcolor colorButton, cd, &quot;&amp;amp;node&amp;amp;&quot;, &quot;&amp;amp;quote&amp;amp;&quot;65535,65535,30000&quot;&amp;amp;quote&amp;amp;return into node_script      put node_script&amp;amp;&quot;  end if&quot;&amp;amp;return into node_script      put node_script&amp;amp;&quot;end checkYoSelf&quot;&amp;amp;return into node_script            set the script of button id node to node_script            put j+1 into j    end repeat        put i+1 into i  end repeat    put 0 into i  repeat for 8        put 0 into j    repeat for 8      makeNode            set the width of button id node to 10      set the height of button id node to 10            set the top of button id node to (61 + 30 * j)      set the left of button id node to (146 + 30 * i)            set the style of button id node to oval      set the name of button id node to &quot;button_&quot;&amp;amp;i&amp;amp;&quot;_&quot;&amp;amp;j            set showName of button id node to false            addcolor colorButton, cd, node, &quot;37632,30208,12288&quot;            put &quot;active_&quot;&amp;amp;i&amp;amp;&quot;_&quot;&amp;amp;j into v_name            put &quot;&quot; into node_script      put node_script&amp;amp;&quot;on mouseUp&quot;&amp;amp;return into node_script      put node_script&amp;amp;&quot;  global &quot;&amp;amp;v_name&amp;amp;&quot;,cursor_x,cursor_y&quot;&amp;amp;return into node_script      put node_script&amp;amp;&quot;  put cursor_x into prev_x&quot;&amp;amp;return into node_script      put node_script&amp;amp;&quot;  put cursor_y into prev_y&quot;&amp;amp;return into node_script      put node_script&amp;amp;&quot;  put abs(cursor_x-&quot;&amp;amp;i&amp;amp;&quot;) into dx&quot;&amp;amp;return into node_script      put node_script&amp;amp;&quot;  put abs(cursor_y-&quot;&amp;amp;j&amp;amp;&quot;) into dy&quot;&amp;amp;return into node_script      put node_script&amp;amp;&quot;  if (&quot;&amp;amp;v_name&amp;amp;&quot; = &quot;&amp;amp;quote&amp;amp;quote&amp;amp;&quot;) and ((dx = 1 and dy = 0) or (dx = 0 and dy = 1)) then&quot;&amp;amp;return into node_script      put node_script&amp;amp;&quot;    put true into &quot;&amp;amp;v_name&amp;amp;return into node_script      put node_script&amp;amp;&quot;    send &quot;&amp;amp;quote&amp;amp;&quot;updateState &quot;&amp;amp;i&amp;amp;&quot;,&quot;&amp;amp;j&amp;amp;quote&amp;amp;&quot; to this cd&quot;&amp;amp;return into node_script      put node_script&amp;amp;&quot;    addcolor colorButton, cd, &quot;&amp;amp;node&amp;amp;&quot;, &quot;&amp;amp;quote&amp;amp;&quot;65535,65535,30000&quot;&amp;amp;quote&amp;amp;return into node_script      put node_script&amp;amp;&quot;  end if&quot;&amp;amp;return into node_script      put node_script&amp;amp;&quot;end mouseUp&quot;&amp;amp;return into node_script            set the script of button id node to node_script            put cd_script&amp;amp;&quot;  addcolor colorButton, cd, &quot;&amp;amp;node&amp;amp;&quot;, &quot;&amp;amp;quote&amp;amp;&quot;37632,30208,12288&quot;&amp;amp;quote&amp;amp;return into cd_script            put j+1 into j    end repeat        put i+1 into i  end repeat    set the width of button button_0_0 to 30  set the height of button button_0_0 to 30    set the top of button button_0_0 to 51  set the left of button button_0_0 to 136    get the id of button button_0_0  addColor colorButton, cd, it, &quot;37632,30208,12288&quot;    put cd_script&amp;amp;&quot;end openCard&quot;&amp;amp;return into cd_script  set the script of this cd to cd_script  end constructPuzzleon checkSolution  global puzzle_id,path,constraints,flag_1,flag_2,flag_3  watnesssolver constraints,path  put the result into success  if success = &quot;true&quot; then    if puzzle_id = 1 then      decoder path,&quot;clrtffxpry&quot;      put the result into flag_1    end if    if puzzle_id = 2 then      decoder path,&quot;nyghq7xksg&quot;      put the result into flag_2    end if    if puzzle_id = 3 then      decoder path,&quot;ppyyvn}1{7&quot;      put the result into flag_3    end if  else    send opencard to this cd  end ifend checkSolutionon updateState i,j  global path,cursor_x,cursor_y    if (i &amp;lt;&amp;gt; 0) or (j &amp;lt;&amp;gt; 0) then    if (cursor_y = j+1) and (cursor_x = i) then      put path&amp;amp;&quot;U&quot; into path    end if    if (cursor_y = j) and (cursor_x = i - 1) then      put path&amp;amp;&quot;R&quot; into path    end if    if (cursor_y = j-1) and (cursor_x = i) then      put path&amp;amp;&quot;D&quot; into path    end if    if (cursor_y = j) and (cursor_x = i + 1) then      put path&amp;amp;&quot;L&quot; into path    end if  end if      if cursor_x &amp;gt;= 0 and cursor_y &amp;gt;= 0 then    put &quot;h_path_&quot;&amp;amp;min(cursor_x, i)&amp;amp;&quot;_&quot;&amp;amp;min(cursor_y, j) into h_path    put &quot;v_path_&quot;&amp;amp;min(cursor_x, i)&amp;amp;&quot;_&quot;&amp;amp;min(cursor_y, j) into v_path        if i = cursor_x then      send checkYoSelf to button v_path    end if        if j = cursor_y then      send checkYoSelf to button h_path    end if      end if    put i into cursor_x  put j into cursor_yend updateStateThe cards script code can also be extracted (puzzle 1):on openCard  global puzzle_id,constraints,path,cursor_x,cursor_y,active_0_0,active_0_1,active_0_2,active_0_3,active_0_4,active_0_5,active_0_6,active_0_7,active_1_0,active_1_1,active_1_2,active_1_3,active_1_4,active_1_5,active_1_6,active_1_7,active_2_0,active_2_1,active_2_2,active_2_3,active_2_4,active_2_5,active_2_6,active_2_7,active_3_0,active_3_1,active_3_2,active_3_3,active_3_4,active_3_5,active_3_6,active_3_7,active_4_0,active_4_1,active_4_2,active_4_3,active_4_4,active_4_5,active_4_6,active_4_7,active_5_0,active_5_1,active_5_2,active_5_3,active_5_4,active_5_5,active_5_6,active_5_7,active_6_0,active_6_1,active_6_2,active_6_3,active_6_4,active_6_5,active_6_6,active_6_7,active_7_0,active_7_1,active_7_2,active_7_3,active_7_4,active_7_5,active_7_6,active_7_7,dummy  colorme  put 1 into puzzle_id  put -1 into cursor_x  put 0 into cursor_y  put &quot;&quot; into path  put &quot;rbrr rgb rb  r brgrbrgb  grrgbbg grg bgrg  bbgrbg&quot; into constraints  addColor colorButton, cd, 1, &quot;65535,0,0&quot;  ...end openCardon arrowKey key  if key = &quot;left&quot;then    go to cd &quot;entry-3-n&quot;  end if  if key = &quot;right&quot;then    go to cd &quot;entry-3-n&quot;  end if  if key = &quot;up&quot;then    go to cd &quot;&quot;  end ifend arrowKeyNow we get the constraint string of this puzzle &quot;rbrr rgb rb  r brgrbrgb  grrgbbg grg bgrg  bbgrbg&quot;, these constraints, along with the path that goes to the lower right corner, are passed into one thing called XCMD which checks the paths correctness natively (it contains binary instructions that directly run over the 68k CPU). There are 2 XCMD binaries which can be extracted by this tool, which seem can only run under MacOS. So Im using the extracted binary from this great post for now instead.Whats more, I found that I can set breakpoints in the script and debug the game, I could even watch the variables on the fly:As for the XCMD part, its basically just a few hours reversing work. There are no reliable decompilers for the 68k architecture so I have to read the assembly. It wasnt too hard, but I did spend several hours learning the basic concepts of the 68ks instruction set though.After the reverse engineering work, the watnesssolvers checking methods can be rewritten in Python as:def build_automaton(constraints: str):    trans = str.maketrans(&#39; rgb&#39;, &#39;0123&#39;)    return [int(c) for c in constraints.translate(trans)]def choose_empty(r, g, b):    if g == 0 and b == 0:        return 0    if b &amp;lt; g:        return 2    else:        return 3def choose_red(r, g, b):    if r != 2 and r != 3:        return 0    if b == 0 or g == 0:        return 0    return 1def choose_green(r, g, b):    if r &amp;lt;= 4:        if b &amp;lt;= 4:            if r == 2 or r == 3:                return 1            else:                return 2        else:            return 3    else:        return 0def choose_blue(r, g, b):    if r &amp;lt;= 4:        if g &amp;lt;= 4:            if r == 2 or r == 3:                return 1            else:                return 3        else:            return 2    else:        return 0def is_red(constraints, x, y):    if not (x &amp;gt;= 0 and x &amp;lt; 7 and y &amp;gt;= 0 and y &amp;lt; 7):        return False    return constraints[x+y*7] == 1def get_neighbors(constraints, x, y, color):    sum = 0    for bias_y in range(-1, 2):        for bias_x in range(-1, 2):            if (bias_x != 0 or bias_y != 0) and (y + bias_y &amp;gt;= 0 and y + bias_y &amp;lt; 7) and &amp;#92;                    (x + bias_x &amp;gt;= 0 and x + bias_x &amp;lt; 7) and constraints[(x+bias_x)+(y+bias_y)*7] == color:                sum += 1    return sumdef step_automaton(constraints):    new_constraints = constraints[:]    for y in range(7):        for x in range(7):            r, g, b = &amp;#92;                get_neighbors(constraints, x, y, 1), &amp;#92;                get_neighbors(constraints, x, y, 2), &amp;#92;                get_neighbors(constraints, x, y, 3)            if constraints[x+y*7] == 0:                new_constraints[x+y*7] = choose_empty(r, g, b)            elif constraints[x+y*7] == 1:                new_constraints[x+y*7] = choose_red(r, g, b)            elif constraints[x+y*7] == 2:                new_constraints[x+y*7] = choose_green(r, g, b)            elif constraints[x+y*7] == 3:                new_constraints[x+y*7] = choose_blue(r, g, b)    return new_constraintsdef perform_move(constraints, mem, x, y, d):    bias_x, bias_y = 0, 0    if d == &#39;U&#39;:        bias_x, bias_y = 0, -1    elif d == &#39;D&#39;:        bias_x, bias_y = 0, 1    elif d == &#39;L&#39;:        bias_x, bias_y = -1, 0    elif d == &#39;R&#39;:        bias_x, bias_y = 1, 0    if not (x+bias_x &amp;gt;= 0 and x+bias_x &amp;lt; 8 and y+bias_y &amp;gt;= 0 and y+bias_y &amp;lt; 8):        return False, x, y    min_x = min(x, x+bias_x)    min_y = min(y, y+bias_y)    if bias_y == 0:        if not (is_red(constraints, min_x, y) or is_red(constraints, min_x, y-1)):            return False, x, y    else:        if not (is_red(constraints, x, min_y) or is_red(constraints, x-1, min_y)):            return False, x, y    if mem[x+bias_x][y+bias_y] == 1:        return False, x, y    mem[x+bias_x][y+bias_y] = 1    return True, x+bias_x, y+bias_ydef solver(path, constraints):    x = y = 0    constraints = build_automaton(constraints)    mem = [[0 for i in range(8)] for j in range(8)]  # been to or not    mem[0][0] = 1    for each in path:        yes, new_x, new_y = perform_move(constraints, mem, x, y, each)        if yes:            if new_x == 7 and new_y == 7:                # print(f&#39;Path `{path}` is great &#39; + &#39;!&#39; * 20)                return True, True            x, y = new_x, new_y            constraints = step_automaton(constraints)        else:            #print(f&#39;Path `{path}` is bad&#39;)            return False, False    return True, FalseLooking around in the game, well know that there are 3 puzzles we need to solve. So we simply run 3 DFS searches on these contraints and three unique solutions will be printed out.def dfs(depth, path, constraints):    if depth &amp;gt; 24: # figured out after multiple tests        return    mov, end = solver(path, constraints)    if end == True:        print(f&#39;Path {path} is ok&#39;)    if mov == False:        return    for d in &#39;LRUD&#39;:        n_path = path + d        dfs(depth+1, n_path, constraints)if __name__ == &#39;__main__&#39;:    constraints_stage1 = &#39;rbrr rgb rb  r brgrbrgb  grrgbbg grg bgrg  bbgrbg&#39;    constraints_stage2 = &#39;rbr  bbggrgrggb   bggbb b  b bbrbbgg gbrrbgrbbb g&#39;    constraints_stage3 = &#39;rrbrb rg g  bgrbgggr ggrgr gr rg brr  b  bggrbgbb&#39;    print(&#39;Stage1 solution:&#39;)    dfs(0, &#39;&#39;, constraints_stage1)    print(&#39;Stage2 solution:&#39;)    dfs(0, &#39;&#39;, constraints_stage2)    print(&#39;Stage3 solution:&#39;)    dfs(0, &#39;&#39;, constraints_stage3)Output:Stage1 solution:Path RDDDRURRRDLLDLDRRURRDDDR is okStage2 solution:Path RDDRURDDDRURULURRDDDDDRD is okStage3 solution:Path DRDDDDRUURRRULURRDDDDDDR is okInput these solutions to each puzzle, after that, we could go to the lock-like thing on the white gate to reveal the flag:"

    } ,
  
    {

      "title"    : "Write Invalid and Cache Coherence",
      "url"      : "/2020/03/12/cache-coherence%E4%B8%AD%E7%9A%84write-invalid",
      "category" : "",
      "tags"     : "distributed computing, cache coherence, write-invalid, class notes",
      "date"     : "2020-03-12 00:00:00 +0800",
      "description" : "",
      "content"  : "// This post was written in ChineseIntro write-updatewrite-invalidate  coherence protocol coherence protocol  snoopy-based  directory-based shared caches  snoop and respondwrite-update  write-invalid   Write-update: When a write operation is observed to a location that a cache has a copy of, the cache controller updates its own copy of the snooped memory location with the new data.  Write-invalidate: When a write operation is observed to a location that a cache has a copy of, the cache controller invalidates its own copy of the snooped memory location, which forces a read from main memory of the new value on its next access.Write-invalidate  write-update  cache  read write  cache copy invalid  invalid  read  invalidation  cache  invalid  cache writes to different words of a blockwrite-update  word  write-invalidate  invalidation  producer-consumer producer  consumer  invalidate  consumer  cache invalid  consumer  cache write-update  write-invalidatewrite-invalidate  producer-consumer  write-update  cache coherency Referenceshttps://www3.nd.edu/~mniemier/teaching/2010_B_Fall/lectures/lec_27_slides.pdfhttps://www.cs.utah.edu/~retrac/papers/hpca07.pdf"

    } 
  
]